version: 0.0.{build}

image: Ubuntu2004

branches:
  only:
    - master

nuget:
  disable_publish_on_pr: true

build_script:
  - git clean -ffxd
  - dotnet restore ./src
  - dotnet build ./src -c Release
  - dotnet test ./src -c Release /p:CollectCoverage=true /p:CoverletOutputFormat=opencover /p:CoverletOutput='../../../artifacts/'
  - dotnet pack ./src -c Release -o ./artifacts /p:VersionPrefix=$APPVEYOR_BUILD_VERSION
  - bash <(curl -s https://codecov.io/bash)

test: off
artifacts:
  - path: ./artifacts/*.nupkg
    name: NuGet
  - path: ./artifacts/*.xml
    name: CodeCoverage